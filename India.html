<!DOCTYPE html>
<html>

<head>
    <title>COVID-19 India</title>
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/jquery-jvectormap-2.0.5.min.js"></script>
    <script src="js/jquery-jvectormap-in-merc.js"></script>
    <link rel="stylesheet" href="css/jquery-jvectormap-2.0.5.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="css/style.css" type="text/css" media="all" />
    <link rel="stylesheet" href="css/india_page.css" type="text/css" media="all" />
    <link rel="stylesheet" href="css/gh-fork-ribbon-0.2.3.min.css" />
    <script src="utils/map_codes.js"></script>
</head>

<body>
    <a class="github-fork-ribbon" href="https://github.com/mayurmadnani/covidtracer" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <ul class="nav">
        <li><a href="index.html">Home</a></li>
        <li><a href="Global.html">Global</a></li>
        <li><a href="India.html">India</a></li>
    </ul>


    <div class="india-map-container">
        <div id="map"></div>
    </div>
    <div id="table-container">
        <h3 id="totalCount" />
        <h4 id="india-table" />
    </div>
</body>

</html>
<script>
    fetch("https://www.mohfw.gov.in/#state-data")
        .then(response => response.text())
        .then(data => {
            var html = $.parseHTML(data);
            var state_data_table = $('#state-data', html);

            var india_table = "<table><tr><th><u>State</u></th><th><u>Active</u></th><th><u>Recovered</u></th><th><u>Deaths</u></th><th><u>Confirmed</u></th></tr>"

            var india_data = {};
            $(state_data_table).find('tbody tr').each(function() {
                $td = $(this).find('td');
                if ($td.length == 6) {
                    state = $td.eq(1).text();
                    counts = {};
                    counts.active = parseInt($td.eq(2).text());
                    counts.recovered = parseInt($td.eq(3).text());
                    counts.deaths = parseInt($td.eq(4).text());
                    counts.confirmed = parseInt($td.eq(5).text());
                    if (state == 'Total#') {
                        india_table += "</table>";
                        $('#india-table').append(india_table);
                        $('#totalCount')
                            .append('<br />Active: ' + counts.active)
                            .append('<br />Recovered: ' + counts.recovered)
                            .append('<br />Deaths: ' + counts.deaths)
                            .append('<br />Confirmed: ' + counts.confirmed);
                        return;
                    }
                    india_data[state] = counts;
                    if (isNaN(counts.active)) {
                        counts.active = ''
                    }
                    if (isNaN(counts.recovered)) {
                        counts.recovered = ''
                    }
                    if (isNaN(counts.deaths)) {
                        counts.deaths = ''
                    }
                    if (isNaN(counts.confirmed)) {
                        counts.confirmed = ''
                    }
                    india_table += "<tr><td>" + state + "</td>" + "<td>" + counts.active + "</td>" + "<td>" + counts.recovered + "</td>" + "<td>" + counts.deaths + "</td>" + "<td>" + counts.confirmed + "</td>" + "</tr>";
                }
            });


            var active_cases = {};
            for (state in india_data) {
                active_cases[india_state_to_code[state]] = india_data[state].active;
            };

            $(function() {
                $('#map').vectorMap({
                    backgroundColor: "#FFFFFF",
                    map: 'in_merc',
                    series: {
                        regions: [{
                            values: active_cases,
                            scale: ['#C8EEFF', '#0071A4'],
                            normalizeFunction: 'polynomial'
                        }]
                    },
                    onRegionTipShow: function(e, el, code) {
                        var state = india_code_to_state[code];
                        var state_data = india_data[state];
                        el.html(el.html() + '<br /> <br />Active: ' + state_data.active + '<br />Recovered: ' + state_data.recovered + '<br />Deaths: ' + state_data.deaths + '<br />Confirmed: ' + state_data.confirmed);
                    }
                });
            });

        });
</script>