<!DOCTYPE html>
<html>

<head>
    <title>COVID-19 India</title>
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/jquery-jvectormap-2.0.5.min.js"></script>
    <script src="js/jquery-jvectormap-in-merc.js"></script>
    <link rel="stylesheet" href="css/jquery-jvectormap-2.0.5.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="css/style.css" type="text/css" media="all" />
    <link rel="stylesheet" href="css/gh-fork-ribbon-0.2.3.min.css" />
    <script src="utils/map_codes.js"></script>
</head>

<body>
    <a class="github-fork-ribbon" href="https://github.com/mayurmadnani/covidtracer" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <ul class="nav">
        <li><a href="Global.html">Global</a></li>
        <li><a href="India.html">India</a></li>
    </ul>

    <h3 id="totalCount" />

    <div class="india-map-container">
        <div id="map"></div>
    </div>
</body>

</html>
<script>
    fetch("https://www.mohfw.gov.in/#state-data")
        .then(response => response.text())
        .then(data => {
            var html = $.parseHTML(data);
            var state_data_table = $('#state-data', html);

            var india_data = {};
            $(state_data_table).find('tbody tr').each(function () {
                $td = $(this).find('td');
                if ($td.length == 5) {
                    state = $td.eq(1).text();
                    counts = {};
                    counts.confirmed = parseInt($td.eq(2).text());
                    counts.recovered = parseInt($td.eq(3).text());
                    counts.deaths = parseInt($td.eq(4).text());
                    india_data[state] = counts;
                }
                else if($td.length==4) {
                    $('#totalCount')
                        .append('<br />Confirmed: ' + parseInt($td.eq(1).text()))
                        .append('<br />Recovered: ' + parseInt($td.eq(2).text()))
                        .append('<br />Deaths: ' + parseInt($td.eq(3).text()))
                        .append('<br />Subject to further verification and reconciliation* '); 
                }
            });


            var confirmed_cases = {};
            for (state in india_data) {
                confirmed_cases[india_state_to_code[state]] = india_data[state].confirmed;
            };

            $(function () {
                $('#map').vectorMap({
                    map: 'in_merc',
                    series: {
                        regions: [{
                            values: confirmed_cases,
                            scale: ['#C8EEFF', '#0071A4'],
                            normalizeFunction: 'polynomial'
                        }]
                    },
                    onRegionTipShow: function (e, el, code) {
                        var state = india_code_to_state[code];
                        var state_data = india_data[state];
                        el.html(el.html() + '<br /> <br />Confirmed: ' + state_data.confirmed + '<br />Recovered: ' + state_data.recovered + '<br />Deaths: ' + state_data.deaths);
                    }
                });
            });

        });

</script>